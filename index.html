<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MARD 豆库 Pro</title>
    <style>
        :root {
            --primary-color: #333333;
            --accent-color: #555555;
            --danger-color: #ff4d4f;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --radius: 12px;
        }

        body {
            font-family: -apple-system, "SF Pro Text", "Helvetica Neue", sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 20px; color: #1d1d1f;
        }

        /* 头部样式 */
        .header {
            background: var(--card-bg);
            padding: 20px; border-radius: var(--radius);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }

        .header-title h1 { margin: 0; font-size: 22px; letter-spacing: -0.5px; }
        .header-title p { margin: 5px 0 0; font-size: 13px; color: #86868b; }

        /* 按钮样式 */
        button {
            padding: 10px 18px; border: none; border-radius: 8px;
            font-weight: 500; cursor: pointer; transition: all 0.2s ease;
        }
        .btn-main { background: var(--primary-color); color: white; }
        .btn-main:hover { background: #000; }
        .btn-sub { background: #e5e5ea; color: #1d1d1f; }

        /* 网格布局 */
        .grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 15px;
        }

        .card {
            background: var(--card-bg); padding: 15px; border-radius: var(--radius);
            text-align: center; border: 2px solid transparent; transition: transform 0.2s;
        }
        .card.low-stock {
            border-color: var(--danger-color); background: #fff1f0;
        }
        .card h3 { margin: 0 0 10px; font-size: 16px; color: #333; }
        .card input {
            width: 70%; border: 1px solid #d2d2d7; border-radius: 6px;
            padding: 6px; text-align: center; font-size: 14px; outline: none;
        }

        /* 弹窗 UI */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); backdrop-filter: blur(8px);
            z-index: 9999; justify-content: center; align-items: center;
        }
        .modal {
            background: white; width: 90%; max-width: 420px;
            border-radius: 20px; padding: 25px; box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        .modal textarea {
            width: 100%; height: 150px; margin: 15px 0; padding: 12px;
            border: 1px solid #e5e5e5; border-radius: 10px; background: #f9f9f9;
            font-family: monospace; box-sizing: border-box; font-size: 12px;
        }
        .modal-footer { display: flex; justify-content: flex-end; gap: 12px; }
        .config-item { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="header">
    <div class="header-title">
        <h1>MARD 豆库 Pro</h1>
        <p id="infoText">正在加载数据...</p>
    </div>
    <div class="btn-group">
        <button class="btn-sub" onclick="openModal('importModal')">导入</button>
        <button class="btn-main" onclick="openConfig()">设置/备份</button>
    </div>
</div>

<div class="grid" id="mainGrid"></div>

<div id="importModal" class="modal-overlay">
    <div class="modal">
        <h2>手动导入数据</h2>
        <p style="color:#666; font-size:13px;">粘贴色号明细（如 A1:36.1 | A2:26.8）</p>
        <textarea id="rawTextarea" placeholder="在这里粘贴文本..."></textarea>
        <div class="modal-footer">
            <button class="btn-sub" onclick="closeModal('importModal')">取消</button>
            <button class="btn-main" onclick="executeImport()">识别并导入</button>
        </div>
    </div>
</div>

<div id="configModal" class="modal-overlay">
    <div class="modal">
        <h2>系统设置</h2>
        <div class="config-item">
            <span>预警阈值 (g)</span>
            <input type="number" id="thresholdInput" style="width:60px; padding:5px; border-radius:5px; border:1px solid #ddd;">
        </div>
        <div style="border-top: 1px solid #eee; padding-top: 15px;">
            <p style="margin:0; font-size:13px; color:#666;">备份数据 (JSON 格式):</p>
            <textarea id="backupTextarea"></textarea>
        </div>
        <div class="modal-footer">
            <button class="btn-sub" onclick="closeModal('configModal')">关闭</button>
            <button class="btn-main" onclick="saveAll()">保存设置</button>
        </div>
    </div>
</div>

<script>
    // 【核心】内置 221 个初始色号数据
    const INITIAL_DATA = {"A1":36.1,"A2":26.8,"A3":18.7,"A4":57.6,"A5":23.6,"A6":15.8,"A7":9.9,"A8":18.9,"A9":15.8,"A10":20.1,"A11":25.9,"A12":18.7,"A13":20.6,"A14":27.1,"A15":19.9,"A16":25.1,"A17":61,"A18":17,"A19":16.4,"A20":12.6,"A21":16,"A22":22.6,"A23":17.9,"A24":16.9,"A25":17,"A26":17.6,"B1":12,"B2":8.2,"B3":16,"B4":10.5,"B5":36,"B6":12.4,"B7":16.4,"B8":16.8,"B9":8.9,"B10":15,"B11":16.7,"B12":21.3,"B13":12,"B14":26.2,"B15":13,"B16":7.4,"B17":7,"B18":15.5,"B19":15.8,"B20":9.5,"B21":10.8,"B22":18.8,"B23":9.6,"B24":10.7,"B25":9.5,"B26":9,"B27":16.9,"B28":10.2,"B29":9.9,"B30":9.6,"B31":9.4,"B32":18.4,"C1":10,"C2":9.3,"C3":18,"C4":15.8,"C5":12.8,"C6":40,"C7":21.9,"C8":11,"C9":10.4,"C10":12.7,"C11":15.2,"C12":17.5,"C13":9.2,"C14":16.5,"C15":10,"C16":10.5,"C17":18.7,"C18":9.8,"C19":8.6,"C20":20.8,"C21":18.6,"C22":8.1,"C23":8.8,"C24":9.7,"C25":8.3,"C26":7.3,"C27":10.4,"C28":8.8,"C29":10,"D1":8.6,"D2":16.1,"D3":15.5,"D4":10.3,"D5":8.9,"D6":17.8,"D7":15.4,"D8":13.6,"D9":14.2,"D10":16.7,"D11":8,"D12":12.9,"D13":15.7,"D14":15.8,"D15":14.8,"D16":13.7,"D17":8.8,"D18":14.8,"D19":15.4,"D20":15.2,"D21":16.1,"D22":10.7,"D23":17.7,"D24":9.6,"D25":10.8,"D26":10.3,"E1":29.2,"E2":26.6,"E3":29,"E4":25,"E5":24.4,"E6":19.8,"E7":25.9,"E8":17.4,"E9":17.4,"E10":18.7,"E11":0,"E12":36.6,"E13":25.4,"E14":21.1,"E15":22.5,"E16":77,"E17":26.2,"E18":26.8,"E19":19.4,"E20":19.8,"E21":19.5,"E22":20.2,"E23":17.1,"E24":20,"F1":20.2,"F2":11,"F3":16.1,"F4":21.7,"F5":65.5,"F6":22.6,"F7":31.6,"F8":9.2,"F9":26.4,"F10":15.6,"F11":18.1,"F12":29.5,"F13":50.7,"F14":18.1,"F15":12.9,"F16":17.2,"F17":25.9,"F18":16.1,"F19":18.5,"F20":17.4,"F21":17.8,"F22":24.9,"F23":19.4,"F24":28.3,"F25":25.5,"G1":25.7,"G2":21.5,"G3":15.9,"G4":21.2,"G5":22.4,"G6":18.8,"G7":11.2,"G8":31.1,"G9":22,"G10":20.3,"G11":15.1,"G12":40.3,"G13":18,"G14":21.6,"G15":24.9,"G16":25.9,"G17":15.2,"G18":21.6,"G19":34.7,"G20":15.6,"G21":16.6,"H1":0,"H2":0,"H3":38.2,"H4":25.8,"H5":27.7,"H6":28,"H7":0,"H8":20.1,"H9":10.2,"H10":8.2,"H11":16,"H12":17.7,"H13":17.8,"H14":8.1,"H15":18.2,"H16":12.5,"H17":28.3,"H18":11.9,"H19":9.2,"H20":9,"H21":36.7,"H22":17.5,"H23":10.7,"M1":15.8,"M2":10,"M3":10.9,"M4":18.3,"M5":10.4,"M6":10.9,"M7":15.5,"M8":15.1,"M9":17.7,"M10":30.1,"M11":9.2,"M12":15.7,"M13":27.8,"M14":25.2,"M15":19};

    let inventory = JSON.parse(localStorage.getItem('mard_pro_data')) || INITIAL_DATA;
    let threshold = parseFloat(localStorage.getItem('mard_pro_ts')) || 5;

    function init() {
        render();
        updateHeader();
    }

    function render() {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = '';
        const keys = Object.keys(inventory).sort((a, b) => 
            a.localeCompare(b, undefined, {numeric: true, sensitivity: 'base'})
        );
        keys.forEach(id => {
            const val = inventory[id];
            const isLow = val <= threshold;
            const div = document.createElement('div');
            div.className = `card ${isLow ? 'low-stock' : ''}`;
            div.innerHTML = `
                <h3>${id}</h3>
                <input type="number" step="0.1" value="${val}" onchange="updateVal('${id}', this.value)">
                <span style="display:block; font-size:10px; color:#999; margin-top:4px;">GRAMS</span>
            `;
            grid.appendChild(div);
        });
    }

    function updateVal(id, val) {
        inventory[id] = parseFloat(val) || 0;
        sync();
    }

    function updateHeader() {
        document.getElementById('infoText').innerText = `当前预警阈值: ${threshold}g | 总数: ${Object.keys(inventory).length}`;
        document.getElementById('thresholdInput').value = threshold;
    }

    function sync() {
        localStorage.setItem('mard_pro_data', JSON.stringify(inventory));
        localStorage.setItem('mard_pro_ts', threshold);
        render();
    }

    function openModal(id) { document.getElementById(id).style.display = 'flex'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    function openConfig() {
        document.getElementById('backupTextarea').value = JSON.stringify(inventory);
        openModal('configModal');
    }

    function executeImport() {
        const raw = document.getElementById('rawTextarea').value;
        const regex = /([A-M]\d+)[:：\s]+(\d+(\.\d+)?)/g;
        let match;
        let count = 0;
        while ((match = regex.exec(raw)) !== null) {
            inventory[match[1]] = parseFloat(match[2]);
            count++;
        }
        if (count > 0) {
            sync();
            alert(`成功导入 ${count} 个色号！`);
            closeModal('importModal');
        } else {
            alert("未识别到有效格式。");
        }
    }

    function saveAll() {
        threshold = parseFloat(document.getElementById('thresholdInput').value) || 0;
        const backTxt = document.getElementById('backupTextarea').value.trim();
        if (backTxt) {
            try {
                inventory = JSON.parse(backTxt);
            } catch (e) { alert("数据格式有误。"); }
        }
        sync();
        updateHeader();
        closeModal('configModal');
    }

    init();
</script>
</body>
</html>
