<!DOCTYPE html>
<html lang="zh-CN">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>MARD è±†åº“ Pro - ç»Ÿè®¡ç‰ˆ</title>
Â  Â  <style>
Â  Â  Â  Â  :root { --primary: #1c1c1e; --accent: #007aff; --warn: #ff3b30; --bg: #f2f2f7; --card: #ffffff; }
Â  Â  Â  Â  body { font-family: -apple-system, "SF Pro Text", sans-serif; background: var(--bg); margin: 0; padding: 0; color: #1c1c1e; }
Â  Â  Â  Â  .container { max-width: 600px; margin: 0 auto; min-height: 100vh; padding-bottom: 100px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* å¤´éƒ¨è®¾è®¡ */
Â  Â  Â  Â  .header-sticky { position: sticky; top: 0; background: rgba(255,255,255,0.8); backdrop-filter: blur(20px); z-index: 100; border-bottom: 0.5px solid #d1d1d6; padding: 15px; }
Â  Â  Â  Â  .top-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 12px; }
Â  Â  Â  Â  .stats-box { display: flex; gap: 15px; }
Â  Â  Â  Â  .stat-item b { font-size: 20px; display: block; letter-spacing: -0.5px; }
Â  Â  Â  Â  .stat-item span { font-size: 11px; color: #8e8e93; text-transform: uppercase; }

Â  Â  Â  Â  /* é…ç½®æ  */
Â  Â  Â  Â  .config-bar { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
Â  Â  Â  Â  .search-input { flex: 1; padding: 10px 12px; border: none; background: #e3e3e6; border-radius: 10px; font-size: 16px; outline: none; }
Â  Â  Â  Â  .btn-tool { background: white; border: 0.5px solid #d1d1d6; padding: 6px 12px; border-radius: 8px; font-size: 12px; cursor: pointer; }
Â  Â  Â  Â  .btn-tool.active { background: var(--primary); color: white; border-color: var(--primary); }

Â  Â  Â  Â  /* åˆ—è¡¨æ¸²æŸ“ */
Â  Â  Â  Â  .bead-row { display: flex; align-items: center; padding: 12px 15px; background: var(--card); border-bottom: 0.5px solid #f2f2f7; transition: 0.2s; }
Â  Â  Â  Â  .bead-row.selected { background: #e9f2ff; }
Â  Â  Â  Â  .swatch { width: 34px; height: 34px; border-radius: 50%; border: 1px solid #eee; margin-right: 12px; box-shadow: inset 0 0 2px rgba(0,0,0,0.1); }
Â  Â  Â  Â  .bead-id { width: 50px; font-weight: 700; font-family: ui-monospace, monospace; font-size: 16px; }
Â  Â  Â  Â  .bead-info { flex: 1; }
Â  Â  Â  Â  .weight-tag { display: inline-block; padding: 4px 10px; border-radius: 6px; background: #f2f2f7; font-weight: 700; font-family: monospace; cursor: pointer; }
Â  Â  Â  Â  .weight-tag.low { background: var(--warn); color: white; }
Â  Â  Â  Â  .sub-info { font-size: 10px; color: #999; margin-top: 3px; display: block; }

Â  Â  Â  Â  /* åº•éƒ¨æ“ä½œ */
Â  Â  Â  Â  .footer { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 500px; background: rgba(28,28,30,0.95); backdrop-filter: blur(10px); color: white; padding: 15px 20px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); z-index: 200; }
Â  Â  Â  Â  .btn-submit { background: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 12px; font-weight: 700; cursor: pointer; }

Â  Â  Â  Â  /* å¼¹çª—æ ·å¼ - iOS é£æ ¼ä¼˜åŒ– */
Â  Â  Â  Â  .overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); backdrop-filter: blur(5px); z-index:1000; }
Â  Â  Â  Â  .modal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:white; padding:25px; border-radius:24px; width: 85%; max-width: 400px; z-index:1010; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
Â  Â  Â  Â  .modal h3 { margin: 0 0 15px; font-size: 20px; text-align: center; }
Â  Â  Â  Â  textarea { width: 100%; height: 120px; border: 1px solid #ddd; border-radius: 12px; padding: 10px; font-size: 12px; font-family: monospace; background: #f9f9f9; box-sizing: border-box; margin-bottom: 15px;}
Â  Â  Â  Â  .modal-btn-group { display: flex; flex-direction: column; gap: 8px; }
Â  Â  Â  Â  .m-btn { width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; }
Â  Â  Â  Â  .m-btn-primary { background: var(--primary); color: white; }
Â  Â  Â  Â  .m-btn-ghost { background: #f2f2f7; color: #333; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .modal-list-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 0.5px solid #eee; }
Â  Â  Â  Â  .modal-list-item input { width: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 8px; text-align: center; }
Â  Â  </style>
</head>
<body>

<div class="container">
Â  Â  <div class="header-sticky">
Â  Â  Â  Â  <div class="top-row">
Â  Â  Â  Â  Â  Â  <div class="stats-box">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-item"><span>æ€»è‰²å·</span><b>221</b></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="stat-item"><span>å¾…è¡¥è´§</span><b id="count-low" style="color:var(--warn)">0</b></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div style="display:flex; gap:8px;">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-tool" onclick="openImport()">åˆå§‹å¯¼å…¥</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-tool" onclick="openBackup()">åŒæ­¥å¤‡ä»½</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="config-bar">
Â  Â  Â  Â  Â  Â  <input type="text" id="search" class="search-input" placeholder="æœç´¢è‰²å·..." oninput="render()">
Â  Â  Â  Â  Â  Â  <div style="font-size:12px; color:#8e8e93;">
Â  Â  Â  Â  Â  Â  Â  Â  é¢„è­¦:<input type="number" id="threshold" style="width:35px; border:none; background:none; font-weight:700; color:var(--accent);" onchange="updateThreshold()">g
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button id="sortBtn" class="btn-tool" onclick="toggleSort()">ğŸ“Š æ’åº</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="grid"></div>
</div>

<div class="footer" id="footer" style="display:none;">
Â  Â  <span>å·²é€‰æ‹© <b id="selNum" style="color:var(--accent)">0</b> ä¸ªè‰²å·</span>
Â  Â  <button class="btn-submit" onclick="openConsume()">æ¶ˆè€—å½•å…¥</button>
</div>

<div class="overlay" id="mask" onclick="closeAllModals()"></div>

<div id="importModal" class="modal">
Â  Â  <h3>åˆå§‹æ•°æ®å¯¼å…¥</h3>
Â  Â  <p style="font-size:12px; color:#666; margin-bottom:10px;">è¯·ç²˜è´´æ•°æ®ï¼ˆå¦‚ A1:36.1 | B2:12.5 æˆ–ç›´æ¥ç²˜è´´è¡¨æ ¼æ–‡å­—ï¼‰</p>
Â  Â  <textarea id="importInput" placeholder="åœ¨æ­¤ç²˜è´´..."></textarea>
Â  Â  <div class="modal-btn-group">
Â  Â  Â  Â  <button class="m-btn m-btn-primary" onclick="handleImport()">è¯†åˆ«å¹¶å­˜å…¥</button>
Â  Â  Â  Â  <button class="m-btn m-btn-ghost" onclick="closeAllModals()">å–æ¶ˆ</button>
Â  Â  </div>
</div>

<div id="backupModal" class="modal">
Â  Â  <h3>æ•°æ®å¤‡ä»½ä¸æ¢å¤</h3>
Â  Â  <textarea id="backupText"></textarea>
Â  Â  <div class="modal-btn-group">
Â  Â  Â  Â  <button class="m-btn m-btn-primary" onclick="copyBackup()">å¤åˆ¶å½“å‰æ•°æ®(å¤‡ä»½)</button>
Â  Â  Â  Â  <button class="m-btn m-btn-ghost" style="color:var(--warn)" onclick="restoreBackup()">è¦†ç›–å¹¶æ¢å¤(ä»ä¸Šæ–¹ç²˜è´´)</button>
Â  Â  Â  Â  <button class="m-btn m-btn-ghost" onclick="closeAllModals()">å…³é—­</button>
Â  Â  </div>
</div>

<div id="consumeModal" class="modal">
Â  Â  <h3>æ¶ˆè€—å½•å…¥(ç²’æ•°)</h3>
Â  Â  <div id="modalList" style="max-height:300px; overflow-y:auto; margin-bottom:15px;"></div>
Â  Â  <div class="modal-btn-group">
Â  Â  Â  Â  <button class="m-btn m-btn-primary" onclick="submitConsume()">ç¡®è®¤æ‰£é™¤</button>
Â  Â  Â  Â  <button class="m-btn m-btn-ghost" onclick="closeAllModals()">å–æ¶ˆ</button>
Â  Â  </div>
</div>

<script>
Â  Â  const MARD_DB = [{id:'A1',hex:'#faf5cd'},{id:'A2',hex:'#fcfed6'},{id:'A3',hex:'#fcff92'},{id:'A4',hex:'#f7ec5c'},{id:'A5',hex:'#f0d83a'},{id:'A6',hex:'#fda951'},{id:'A7',hex:'#fa8c4f'},{id:'A8',hex:'#fbda4d'},{id:'A9',hex:'#f79d5f'},{id:'A10',hex:'#f47e38'},{id:'A11',hex:'#fedb99'},{id:'A12',hex:'#fda276'},{id:'A13',hex:'#fec667'},{id:'A14',hex:'#f75842'},{id:'A15',hex:'#fbf65e'},{id:'A16',hex:'#feff97'},{id:'A17',hex:'#fde173'},{id:'A18',hex:'#fcbf80'},{id:'A19',hex:'#fd7e77'},{id:'A20',hex:'#f9d66e'},{id:'A21',hex:'#fae393'},{id:'A22',hex:'#edf878'},{id:'A23',hex:'#e4c8ba'},{id:'A24',hex:'#f3f6a9'},{id:'A25',hex:'#ffd785'},{id:'A26',hex:'#ffc734'},{id:'B1',hex:'#dff13b'},{id:'B2',hex:'#64f343'},{id:'B3',hex:'#a1f586'},{id:'B4',hex:'#5fdf34'},{id:'B5',hex:'#39e158'},{id:'B6',hex:'#64e0a4'},{id:'B7',hex:'#3eae7c'},{id:'B8',hex:'#1d9b54'},{id:'B9',hex:'#2a5037'},{id:'B10',hex:'#9ad1ba'},{id:'B11',hex:'#627032'},{id:'B12',hex:'#1a6e3d'},{id:'B13',hex:'#c8e87d'},{id:'B14',hex:'#abe84f'},{id:'B15',hex:'#305335'},{id:'B16',hex:'#c0ed9c'},{id:'B17',hex:'#9eb33e'},{id:'B18',hex:'#e6ed4f'},{id:'B19',hex:'#26b78e'},{id:'B20',hex:'#cbeccf'},{id:'B21',hex:'#18616a'},{id:'B22',hex:'#0a4241'},{id:'B23',hex:'#343b1a'},{id:'B24',hex:'#e8faa6'},{id:'B25',hex:'#4e846d'},{id:'B26',hex:'#907c35'},{id:'B27',hex:'#d0e0af'},{id:'B28',hex:'#9ee5bb'},{id:'B29',hex:'#c6df5f'},{id:'B30',hex:'#e3fbb1'},{id:'B31',hex:'#b4e691'},{id:'B32',hex:'#92ad60'},{id:'C1',hex:'#f0fee4'},{id:'C2',hex:'#abf8fe'},{id:'C3',hex:'#a2e0f7'},{id:'C4',hex:'#44cdfb'},{id:'C5',hex:'#06aadf'},{id:'C6',hex:'#54a7e9'},{id:'C7',hex:'#3977ca'},{id:'C8',hex:'#0f52bd'},{id:'C9',hex:'#3349c3'},{id:'C10',hex:'#3cbce3'},{id:'C11',hex:'#2aded3'},{id:'C12',hex:'#1e334e'},{id:'C13',hex:'#cde7fe'},{id:'C14',hex:'#d5fcf7'},{id:'C15',hex:'#21c5c4'},{id:'C16',hex:'#1858a2'},{id:'C17',hex:'#02d1f3'},{id:'C18',hex:'#213244'},{id:'C19',hex:'#18869d'},{id:'C20',hex:'#1a70a9'},{id:'C21',hex:'#bcddfc'},{id:'C22',hex:'#6bb1bb'},{id:'C23',hex:'#c8e2fd'},{id:'C24',hex:'#7ec5f9'},{id:'C25',hex:'#a9e8e0'},{id:'C26',hex:'#42adcf'},{id:'C27',hex:'#d0def9'},{id:'C28',hex:'#bdcee8'},{id:'C29',hex:'#364a89'},{id:'D1',hex:'#acb7ef'},{id:'D2',hex:'#868dd3'},{id:'D3',hex:'#3554af'},{id:'D4',hex:'#162d7b'},{id:'D5',hex:'#b34ec6'},{id:'D6',hex:'#b37bdc'},{id:'D7',hex:'#8758a9'},{id:'D8',hex:'#e3d2fe'},{id:'D9',hex:'#d5b9f4'},{id:'D10',hex:'#301a49'},{id:'D11',hex:'#beb9e2'},{id:'D12',hex:'#dc99ce'},{id:'D13',hex:'#b5038d'},{id:'D14',hex:'#862993'},{id:'D15',hex:'#2f1f8c'},{id:'D16',hex:'#e2e4f0'},{id:'D17',hex:'#c7d3f9'},{id:'D18',hex:'#9a64b8'},{id:'D19',hex:'#d8c2d9'},{id:'D20',hex:'#9a35ad'},{id:'D21',hex:'#940595'},{id:'D22',hex:'#38389a'},{id:'D23',hex:'#eadbf8'},{id:'D24',hex:'#768ae1'},{id:'D25',hex:'#4950c2'},{id:'D26',hex:'#d6c6eb'},{id:'E1',hex:'#f6d4cb'},{id:'E2',hex:'#fcc1dd'},{id:'E3',hex:'#f6bde8'},{id:'E4',hex:'#e8649e'},{id:'E5',hex:'#f0569f'},{id:'E6',hex:'#eb4172'},{id:'E7',hex:'#c53674'},{id:'E8',hex:'#fddbe9'},{id:'E9',hex:'#e376c7'},{id:'E10',hex:'#d13b95'},{id:'E11',hex:'#f7dad4'},{id:'E12',hex:'#f693bf'},{id:'E13',hex:'#b5026a'},{id:'E14',hex:'#fad4bf'},{id:'E15',hex:'#f5c9ca'},{id:'E16',hex:'#fbf4ec'},{id:'E17',hex:'#f7e3ec'},{id:'E18',hex:'#f9c8db'},{id:'E19',hex:'#f6bbd1'},{id:'E20',hex:'#d7c6ce'},{id:'E21',hex:'#c09da4'},{id:'E22',hex:'#b38c9f'},{id:'E23',hex:'#937d8a'},{id:'E24',hex:'#debee5'},{id:'F1',hex:'#fe9381'},{id:'F2',hex:'#f63d4b'},{id:'F3',hex:'#ee4e3e'},{id:'F4',hex:'#fb2a40'},{id:'F5',hex:'#e10328'},{id:'F6',hex:'#913635'},{id:'F7',hex:'#911932'},{id:'F8',hex:'#bb0126'},{id:'F9',hex:'#e0677a'},{id:'F10',hex:'#874628'},{id:'F11',hex:'#592323'},{id:'F12',hex:'#f3536b'},{id:'F13',hex:'#f45c45'},{id:'F14',hex:'#fcadb2'},{id:'F15',hex:'#d50527'},{id:'F16',hex:'#f8c0a9'},{id:'F17',hex:'#e89b7d'},{id:'F18',hex:'#d07f4a'},{id:'F19',hex:'#be454a'},{id:'F20',hex:'#c69495'},{id:'F21',hex:'#f2b8c6'},{id:'F22',hex:'#f7c3d0'},{id:'F23',hex:'#ed806c'},{id:'F24',hex:'#e09daf'},{id:'F25',hex:'#e84854'},{id:'G1',hex:'#ffe4d3'},{id:'G2',hex:'#fcc6ac'},{id:'G3',hex:'#f1c4a5'},{id:'G4',hex:'#dcb387'},{id:'G5',hex:'#e7b34e'},{id:'G6',hex:'#e3a014'},{id:'G7',hex:'#985c3a'},{id:'G8',hex:'#713d2f'},{id:'G9',hex:'#e4b685'},{id:'G10',hex:'#da8c42'},{id:'G11',hex:'#dac898'},{id:'G12',hex:'#fec993'},{id:'G13',hex:'#b2714b'},{id:'G14',hex:'#8b684c'},{id:'G15',hex:'#f6f8e3'},{id:'G16',hex:'#f2d8c1'},{id:'G17',hex:'#77544e'},{id:'G18',hex:'#ffe3d5'},{id:'G19',hex:'#dd7d41'},{id:'G20',hex:'#a5452f'},{id:'G21',hex:'#b38561'},{id:'H1',hex:'#ffffff'},{id:'H2',hex:'#fbfbfb'},{id:'H3',hex:'#b4b4b4'},{id:'H4',hex:'#878787'},{id:'H5',hex:'#464646'},{id:'H6',hex:'#2c2c2c'},{id:'H7',hex:'#010101'},{id:'H8',hex:'#e7d6dc'},{id:'H9',hex:'#efedee'},{id:'H10',hex:'#ebebeb'},{id:'H11',hex:'#cdcdcd'},{id:'H12',hex:'#fdf6ee'},{id:'H13',hex:'#f4efd1'},{id:'H14',hex:'#ced7d4'},{id:'H15',hex:'#9aa6a6'},{id:'H16',hex:'#1b1213'},{id:'H17',hex:'#f0eeef'},{id:'H18',hex:'#fcfff6'},{id:'H19',hex:'#f2eee5'},{id:'H20',hex:'#96a09f'},{id:'H21',hex:'#f8fbe6'},{id:'H22',hex:'#cacad2'},{id:'H23',hex:'#9b9c94'},{id:'M1',hex:'#bbc6b6'},{id:'M2',hex:'#909994'},{id:'M3',hex:'#697e81'},{id:'M4',hex:'#e0d4bc'},{id:'M5',hex:'#d1ccaf'},{id:'M6',hex:'#b0aa86'},{id:'M7',hex:'#b0a796'},{id:'M8',hex:'#ae8082'},{id:'M9',hex:'#a68862'},{id:'M10',hex:'#c4b3bb'},{id:'M11',hex:'#9d7693'},{id:'M12',hex:'#644b51'},{id:'M13',hex:'#c79266'},{id:'M14',hex:'#c27563'},{id:'M15',hex:'#747d7a'}];

Â  Â  let data = JSON.parse(localStorage.getItem('mard_v2_data')) || MARD_DB.map(i => ({...i, w: 0, totalUsed: 0}));
Â  Â  let threshold = parseFloat(localStorage.getItem('mard_v2_ts')) || 5;
Â  Â  let sortByUse = false;
Â  Â  let sel = new Set();

Â  Â  function render() {
Â  Â  Â  Â  // ä¿®æ­£é˜ˆå€¼æ˜¾ç¤º
Â  Â  Â  Â  document.getElementById('threshold').value = threshold;
Â  Â  Â  Â  const q = document.getElementById('search').value.toUpperCase();
Â  Â  Â  Â  const grid = document.getElementById('grid');
Â  Â  Â  Â  grid.innerHTML = '';
Â  Â  Â  Â  let lowCount = 0;

Â  Â  Â  Â  let display = [...data];
Â  Â  Â  Â  if(sortByUse) display.sort((a,b) => b.totalUsed - a.totalUsed);
Â  Â  Â  Â  else display.sort((a,b) => a.id.localeCompare(b.id, undefined, {numeric:true}));

Â  Â  Â  Â  display.forEach(item => {
Â  Â  Â  Â  Â  Â  if(!item.id.includes(q)) return;
Â  Â  Â  Â  Â  Â  const isLow = item.w < threshold && item.w > 0;
Â  Â  Â  Â  Â  Â  if(isLow) lowCount++;

Â  Â  Â  Â  Â  Â  const row = document.createElement('div');
Â  Â  Â  Â  Â  Â  row.className = `bead-row ${sel.has(item.id)?'selected':''}`;
Â  Â  Â  Â  Â  Â  row.onclick = () => toggleSel(item.id);
Â  Â  Â  Â  Â  Â  row.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="swatch" style="background:${item.hex}"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bead-id">${item.id}</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bead-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="weight-tag ${isLow?'low':''}" onclick="event.stopPropagation(); manualEdit('${item.id}')">${item.w}g</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="sub-info">ç´¯è®¡æ¶ˆè€—: ${item.totalUsed.toFixed(2)}g</span>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-tool" onclick="event.stopPropagation(); quickAdd('${item.id}')">+10g</button>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  grid.appendChild(row);
Â  Â  Â  Â  });
Â  Â  Â  Â  document.getElementById('count-low').innerText = lowCount;
Â  Â  Â  Â  save();
Â  Â  }

Â  Â  function toggleSel(id) {
Â  Â  Â  Â  sel.has(id) ? sel.delete(id) : sel.add(id);
Â  Â  Â  Â  document.getElementById('footer').style.display = sel.size > 0 ? 'flex' : 'none';
Â  Â  Â  Â  document.getElementById('selNum').innerText = sel.size;
Â  Â  Â  Â  render();
Â  Â  }

Â  Â  function updateThreshold() {
Â  Â  Â  Â  threshold = parseFloat(document.getElementById('threshold').value) || 0;
Â  Â  Â  Â  localStorage.setItem('mard_v2_ts', threshold);
Â  Â  Â  Â  render();
Â  Â  }

Â  Â  function quickAdd(id) {
Â  Â  Â  Â  const item = data.find(d => d.id === id);
Â  Â  Â  Â  item.w = parseFloat((item.w + 10).toFixed(2));
Â  Â  Â  Â  render();
Â  Â  }

Â  Â  function manualEdit(id) {
Â  Â  Â  Â  const item = data.find(d => d.id === id);
Â  Â  Â  Â  const v = prompt(`ä¿®æ”¹ [${id}] åº“å­˜é‡é‡(g):`, item.w);
Â  Â  Â  Â  if(v !== null) { item.w = parseFloat(v) || 0; render(); }
Â  Â  }

Â  Â  // --- å¼¹çª—åŠŸèƒ½é€»è¾‘ ---
Â  Â  function openImport() { showModal('importModal'); }
Â  Â  function handleImport() {
Â  Â  Â  Â  const raw = document.getElementById('importInput').value;
Â  Â  Â  Â  const regex = /([A-M]\d+)[:ï¼š\s]+(\d+(\.\d+)?)/g;
Â  Â  Â  Â  let match, count = 0;
Â  Â  Â  Â  while ((match = regex.exec(raw)) !== null) {
Â  Â  Â  Â  Â  Â  const target = data.find(d => d.id === match[1]);
Â  Â  Â  Â  Â  Â  if(target) { target.w = parseFloat(match[2]); count++; }
Â  Â  Â  Â  }
Â  Â  Â  Â  alert(`è¯†åˆ«æˆåŠŸï¼Œå·²åŒæ­¥ ${count} ä¸ªè‰²å·é‡é‡ï¼`);
Â  Â  Â  Â  closeAllModals();
Â  Â  Â  Â  render();
Â  Â  }

Â  Â  function openBackup() {
Â  Â  Â  Â  document.getElementById('backupText').value = JSON.stringify(data);
Â  Â  Â  Â  showModal('backupModal');
Â  Â  }
Â  Â  function copyBackup() {
Â  Â  Â  Â  const txt = document.getElementById('backupText');
Â  Â  Â  Â  txt.select();
Â  Â  Â  Â  document.execCommand('copy');
Â  Â  Â  Â  alert("å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·ç²˜è´´åˆ°å¤‡å¿˜å½•ä¿å­˜ã€‚");
Â  Â  }
Â  Â  function restoreBackup() {
Â  Â  Â  Â  const txt = document.getElementById('backupText').value;
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  const json = JSON.parse(txt);
Â  Â  Â  Â  Â  Â  if(Array.isArray(json)) { data = json; save(); render(); alert("æ¢å¤æˆåŠŸï¼"); closeAllModals(); }
Â  Â  Â  Â  } catch(e) { alert("æ•°æ®æ ¼å¼æ— æ•ˆï¼Œè¯·æ£€æŸ¥ç²˜è´´å†…å®¹ã€‚"); }
Â  Â  }

Â  Â  function openConsume() {
Â  Â  Â  Â  const list = document.getElementById('modalList');
Â  Â  Â  Â  list.innerHTML = '';
Â  Â  Â  Â  sel.forEach(id => {
Â  Â  Â  Â  Â  Â  const item = data.find(d => d.id === id);
Â  Â  Â  Â  Â  Â  list.innerHTML += `
Â  Â  Â  Â  Â  Â  Â  Â  <div class="modal-list-item">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; align-items:center;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="swatch" style="width:20px; height:20px; margin-right:8px; background:${item.hex}"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <b>${id}</b>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" class="c-input" data-id="${id}" placeholder="ç²’æ•°">
Â  Â  Â  Â  Â  Â  Â  Â  </div>`;
Â  Â  Â  Â  });
Â  Â  Â  Â  showModal('consumeModal');
Â  Â  }

Â  Â  function submitConsume() {
Â  Â  Â  Â  document.querySelectorAll('.c-input').forEach(input => {
Â  Â  Â  Â  Â  Â  const count = parseFloat(input.value) || 0;
Â  Â  Â  Â  Â  Â  if(count > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const item = data.find(d => d.id === input.dataset.id);
Â  Â  Â  Â  Â  Â  Â  Â  const g = count / 100;
Â  Â  Â  Â  Â  Â  Â  Â  item.w = Math.max(0, parseFloat((item.w - g).toFixed(2)));
Â  Â  Â  Â  Â  Â  Â  Â  item.totalUsed = parseFloat((item.totalUsed + g).toFixed(2));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  sel.clear();
Â  Â  Â  Â  document.getElementById('footer').style.display = 'none';
Â  Â  Â  Â  closeAllModals();
Â  Â  Â  Â  render();
Â  Â  }

Â  Â  function toggleSort() { sortByUse = !sortByUse; render(); }
Â  Â  function showModal(id) { document.getElementById('mask').style.display='block'; document.getElementById(id).style.display='block'; }
Â  Â  function closeAllModals() { document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); document.getElementById('mask').style.display='none'; }
Â  Â  function save() { localStorage.setItem('mard_v2_data', JSON.stringify(data)); }

Â  Â  render();
</script>
</body>
</html>
